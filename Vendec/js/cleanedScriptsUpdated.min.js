document.addEventListener("DOMContentLoaded", function() {
    let burger = document.getElementById("burger");
    let overlay = document.querySelector("section");
    let showMenu = false;

    overlay.style.display = "none";

    $('.testimonials-carousel').slick({
        dots: true,
        infinite: true,
        speed: 600,
        slidesToShow: 1,
        autoplay: true,
        autoplaySpeed: 3000,
    });

    burger.addEventListener("click", function(e) {
        showMenu = !showMenu;
        if (showMenu) {
            burger.classList.add("active");
            overlay.style.display = "block";
            gsap.to(overlay, .65, {
                clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
                ease: "expo.in"
            });
        } else {
            burger.classList.remove("active");
            gsap.to(overlay, .65, {
                clipPath: "polygon(100% 0%, 100% 0%, 100% 100%, 100% 100%)",
                ease: "expo.out",
                onComplete: () => overlay.style.display = "none"
            });
        }
    });

    const recentDiv = document.querySelector(".recent");
    if (recentDiv) {
        const showRecentDiv = () => {
            const rect = recentDiv.getBoundingClientRect();
            const windowHeight = window.innerHeight || document.documentElement.clientHeight;
            const triggerPosition = 100;
            if (rect.top <= windowHeight - triggerPosition) {
                recentDiv.classList.add("visible");
            } else {
                recentDiv.classList.remove("visible");
            }
        };
        window.addEventListener("scroll", showRecentDiv);
    }
    const carousel = document.querySelectorAll(".testimonials-carousel");

// Loop through each .photo-section element and add the scroll event listener
carousel.forEach((photoSection) => {
    const showPhotoSection = () => {
        const rect = photoSection.getBoundingClientRect();
        const windowHeight = window.innerHeight || document.documentElement.clientHeight;
        const triggerPosition = 100;
        if (rect.top <= windowHeight - triggerPosition) {
            photoSection.classList.add("visible");
        } else {
            photoSection.classList.remove("visible");
        }
    };
    window.addEventListener("scroll", showPhotoSection);
});
const photoSections = document.querySelectorAll(".photo-section");
photoSections.forEach((photoSection) => {
    const showPhotoSection = () => {
        const rect = photoSection.getBoundingClientRect();
        const windowHeight = window.innerHeight || document.documentElement.clientHeight;
        const triggerPosition = 100;
        if (rect.top <= windowHeight - triggerPosition) {
            photoSection.classList.add("visible");
        } else {
            photoSection.classList.remove("visible");
        }
    };
    window.addEventListener("scroll", showPhotoSection);
});

    const projektyLink = document.getElementById("projekty-link");
    const sublinks = document.querySelector(".sublinks");
    projektyLink.addEventListener("click", function(event) {
        event.preventDefault();
        sublinks.classList.toggle("open");
    });

    window.onload = function() {
        $('.photo-wrapper img').on('click', function() {
            var modal = $(this).siblings('.carousel-modal');
            modal.css('display', 'flex');
            
            var carouselContainer = modal.find('.carousel-container');
            
            // Initialize the carousel without waiting for images to load
            if (!carouselContainer.hasClass('slick-initialized')) {
                carouselContainer.slick({
                    dots: true,
                    infinite: true,
                    speed: 600,
                    slidesToShow: 1,
                    adaptiveHeight: true,
                    autoplay: true,
                    autoplaySpeed: 3000,
                });
            }
        });
        
        $(document).on('click', function(event) {
            if (!$(event.target).closest('.carousel-container').length && !$(event.target).closest('.photo-wrapper img').length) {
                $('.carousel-modal .carousel-container.slick-initialized').slick('unslick');
                $('.carousel-modal').css('display', 'none');
            }
        });
    };
});